#!/usr/bin/env nix-shell
#!nix-shell -i bash
#!nix-shell -I nixpkgs=./nix
#!nix-shell -p shfmt
#!nix-shell -p nix
#!nix-shell --pure
# vim: ft=sh sw=2 et

set -euo pipefail

## Functions

banner() {
  echo
  echo "--- $*"
}

fail() {
  echo "ERROR: $*"
  exit 1
}

## Main

cd "$(dirname "$0")/.."

nix-build --option build-use-sandbox false --no-out-link ./tests.nix

banner "Test this file's formatting"
list=$(shfmt -i 2 -l script/test)
if [[ -n "$list" ]]; then
  fail "Please apply script/snack-fmt to format script/test"
fi
echo OK
